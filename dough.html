<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ù„Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© - ÙØ±Ù† Ø­Ø³ÙŠÙ† Ø§Ù„Ø¯Ù„ÙŠÙ…ÙŠ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <button onclick="logout()" class="logout-btn">
                <span>ğŸšª</span>
                <span>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</span>
            </button>
            <h1>ğŸ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ğŸ</h1>
            <p>ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­ ÙˆØ§Ù„Ù…Ø³Ø§Ø¡</p>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></li>
                <li><a href="dough.html" class="active">Ø§Ù„Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©</a></li>
                <li><a href="electric.html"> Ø§Ù„ÙƒÙ‡Ø±Ø¨Ø§Ø¦ÙŠ</a></li>
                <li><a href="differences.html">Ø§Ù„ÙØ±ÙˆÙ‚Ø§Øª</a></li>
                <li><a href="dough_records.html">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª</a></li>
                <li><a href="expenses.html">Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</a></li>
                <li><a href="profit.html">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ</a></li>
            </ul>
        </nav>

        <!-- Ù†Ù…ÙˆØ°Ø¬ Ø¥Ø¶Ø§ÙØ© Ø¹Ø¬Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø© -->
        <div class="form-container">
            <h2 style="color: var(--gold); margin-bottom: 20px;">Ø¥Ø¶Ø§ÙØ© Ø¹Ø¬Ù†Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</h2>
            
            <div id="alertMessage"></div>

            <form id="doughForm">
                <div class="form-group">
                    <label for="date">Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" id="date" name="date" required>
                </div>

                <div class="form-group">
                    <label for="morningCount">Ø¹Ø¯Ø¯ Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ØµØ¨Ø§Ø­</label>
                    <input type="number" id="morningCount" name="morningCount" min="0" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯" required>
                </div>

                <div class="form-group">
                    <label for="eveningCount">Ø¹Ø¯Ø¯ Ø¹Ø¬Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø§Ø¡</label>
                    <input type="number" id="eveningCount" name="eveningCount" min="0" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø¹Ø¯Ø¯" required>
                </div>

                <div class="cards-grid">
                    <div class="card">
                        <div class="card-title">Ø±Ø¨Ø­ Ø§Ù„ØµØ¨Ø§Ø­</div>
                        <div class="card-value" id="morningProfit">0</div>
                        <div class="card-label">Ø£Ù„Ù Ø¯ÙŠÙ†Ø§Ø±</div>
                    </div>

                    <div class="card">
                        <div class="card-title">Ø±Ø¨Ø­ Ø§Ù„Ù…Ø³Ø§Ø¡</div>
                        <div class="card-value" id="eveningProfit">0</div>
                        <div class="card-label">Ø£Ù„Ù Ø¯ÙŠÙ†Ø§Ø±</div>
                    </div>

                    <div class="card">
                        <div class="card-title">Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
                        <div class="card-value" id="totalProfit">0</div>
                        <div class="card-label">Ø£Ù„Ù Ø¯ÙŠÙ†Ø§Ø±</div>
                    </div>
                </div>

                <p style="text-align: center; color: var(--light-gray); margin-top: 15px; font-size: 0.9rem;">
                    ğŸ’¡ Ø§Ù„Ø£Ø±Ø¨Ø§Ø­ Ù…Ø¹Ø±ÙˆØ¶Ø© Ø¨Ø§Ù„Ø£Ù„Ù Ø¯ÙŠÙ†Ø§Ø± Ù„Ù„ØªØ¨Ø³ÙŠØ· (Ù…Ø«Ù„Ø§Ù‹: 150 = 150,000 Ø¯ÙŠÙ†Ø§Ø±)
                </p>

                <div class="btn-group">
                    <button type="submit" class="btn btn-success">Ø­ÙØ¸ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª</button>
                    <button type="button" class="btn btn-primary" onclick="resetForm()">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
                </div>
            </form>
        </div>

        <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª Ø§Ù„Ù…Ø³Ø¬Ù„Ø© -->
        <div class="table-container">
            <h2 style="color: var(--gold); margin-bottom: 20px;">Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª</h2>
            
            <div id="doughTableContainer">
                <table id="doughTable">
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„ØµØ¨Ø§Ø­</th>
                            <th>Ø§Ù„Ù…Ø³Ø§Ø¡</th>
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th>Ø±Ø¨Ø­ Ø§Ù„ØµØ¨Ø§Ø­</th>
                            <th>Ø±Ø¨Ø­ Ø§Ù„Ù…Ø³Ø§Ø¡</th>
                            <th>Ø§Ù„Ø±Ø¨Ø­ Ø§Ù„ÙƒÙ„ÙŠ</th>
                            <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody id="doughTableBody">
                        <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script src="db.js"></script>
    <script src="auth-check.js"></script>
    <script>
        let editingId = null;

        // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø§Ù„ÙŠ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
        document.getElementById('date').valueAsDate = new Date();

        // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø±Ø¨Ø­ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØºÙŠÙŠØ±
        document.getElementById('morningCount').addEventListener('input', calculateProfit);
        document.getElementById('eveningCount').addEventListener('input', calculateProfit);

        function calculateProfit() {
            const morningCount = parseInt(document.getElementById('morningCount').value) || 0;
            const eveningCount = parseInt(document.getElementById('eveningCount').value) || 0;

            const morningProfit = (morningCount * 10) / 8;
            const eveningProfit = (eveningCount * 10) / 8;
            const totalProfit = morningProfit + eveningProfit;

            document.getElementById('morningProfit').textContent = formatThousands(morningProfit);
            document.getElementById('eveningProfit').textContent = formatThousands(eveningProfit);
            document.getElementById('totalProfit').textContent = formatThousands(totalProfit);
        }

        // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        document.getElementById('doughForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const formData = {
                date: document.getElementById('date').value,
                morning_count: document.getElementById('morningCount').value,
                evening_count: document.getElementById('eveningCount').value
            };

            try {
                if (editingId) {
                    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
                    await db.updateDough(editingId, formData);
                    showAlert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    editingId = null;
                } else {
                    // Ø¥Ø¶Ø§ÙØ© Ø³Ø¬Ù„ Ø¬Ø¯ÙŠØ¯
                    await db.addDough(formData);
                    showAlert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                }

                resetForm();
                await loadDoughTable();
            } catch (error) {
                console.error('Error saving dough:', error);
                showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­ÙØ¸: ' + error.message, 'danger');
            }
        });

        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        function resetForm() {
            document.getElementById('doughForm').reset();
            document.getElementById('date').valueAsDate = new Date();
            editingId = null;
            calculateProfit();
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªÙ†Ø¨ÙŠÙ‡
        function showAlert(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.innerHTML = `<div class="alert alert-${type}">${message}</div>`;
            
            setTimeout(() => {
                alertDiv.innerHTML = '';
            }, 3000);
        }

        // ØªØ­Ù…ÙŠÙ„ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¹Ø¬Ù†Ø§Øª (Ø¹Ø¬Ù†Ø§Øª Ø§Ù„ÙŠÙˆÙ… ÙÙ‚Ø· - Ù…Ù† Ø§Ù„Ø£ÙˆÙ„ Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø®ÙŠØ±)
        async function loadDoughTable() {
            const dough = await db.getTodayDough(); // ÙŠØªÙ… Ø§Ù„ØªØ±ØªÙŠØ¨ ØªØµØ§Ø¹Ø¯ÙŠØ§Ù‹ Ù…Ù† Ø§Ù„Ø¯Ø§Ù„Ø©
            const tbody = document.getElementById('doughTableBody');

            if (dough.length === 0) {
                const today = new Date().toLocaleDateString('ar-EG', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="empty-state">
                            <div class="empty-state-icon">ğŸ“‹</div>
                            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø¬Ù†Ø§Øª Ù…Ø³Ø¬Ù„Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„ÙŠÙˆÙ…</p>
                            <p style="font-size: 0.9rem; color: var(--light-gray); margin-top: 10px;">${today}</p>
                        </td>
                    </tr>
                `;
                return;
            }

            tbody.innerHTML = dough.map((record, index) => `
                <tr>
                    <td>${record.date}</td>
                    <td>${formatNumber(record.morning_count, 0)}</td>
                    <td>${formatNumber(record.evening_count, 0)}</td>
                    <td><strong>${formatNumber(record.morning_count + record.evening_count, 0)}</strong></td>
                    <td>${formatThousands(record.morning_profit)}</td>
                    <td>${formatThousands(record.evening_profit)}</td>
                    <td><strong>${formatThousands(record.total_profit)}</strong></td>
                    <td>
                        <button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.9rem;" onclick="editDough(${record.id})">ØªØ¹Ø¯ÙŠÙ„</button>
                        <button class="btn btn-danger" onclick="deleteDough(${record.id})">Ø­Ø°Ù</button>
                    </td>
                </tr>
            `).join('');
        }

        // ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø¬Ù†Ø©
        async function editDough(id) {
            const dough = await db.getTodayDough();
            const record = dough.find(d => d.id === id);
            
            if (record) {
                document.getElementById('date').value = record.date;
                document.getElementById('morningCount').value = record.morning_count;
                document.getElementById('eveningCount').value = record.evening_count;
                calculateProfit();
                editingId = id;
                
                // Ø§Ù„ØªÙ…Ø±ÙŠØ± Ù„Ù„Ø£Ø¹Ù„Ù‰
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        // Ø­Ø°Ù Ø¹Ø¬Ù†Ø©
        async function deleteDough(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
                try {
                    await db.deleteDough(id);
                    showAlert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø³Ø¬Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                    await loadDoughTable();
                } catch (error) {
                    console.error('Error deleting dough:', error);
                    showAlert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù', 'danger');
                }
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        document.addEventListener('DOMContentLoaded', async () => {
            await loadDoughTable();
            calculateProfit();
        });
    </script>
</body>
</html>

