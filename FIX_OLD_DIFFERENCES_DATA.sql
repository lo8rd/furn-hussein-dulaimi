-- ═══════════════════════════════════════════════════════════════════
-- 🔧 تصحيح البيانات القديمة في جدول differences
-- ═══════════════════════════════════════════════════════════════════
-- 
-- هذا السكريبت يُصحح القيم المُخزنة بالدينار الفعلي (القديمة)
-- ويُحولها إلى الآلاف (الجديدة) لتتوافق مع باقي النظام
--
-- ⚠️ فقط نفذ هذا إذا كان لديك بيانات قديمة في جدول differences
--
-- ═══════════════════════════════════════════════════════════════════

-- الخطوة 1: التحقق من البيانات الحالية
-- (هذا للعرض فقط - لا يُجري أي تغيير)
SELECT 
    id,
    date,
    type,
    quantity,
    total_value as "القيمة_الحالية",
    total_value / 1000 as "القيمة_المُصححة",
    CASE 
        WHEN total_value > 10000 THEN '⚠️ يحتاج تصحيح'
        ELSE '✅ صحيح'
    END as "الحالة"
FROM differences
ORDER BY date DESC;

-- ═══════════════════════════════════════════════════════════════════

-- الخطوة 2: تصحيح البيانات القديمة
-- (احذف التعليق -- لتنفيذ التصحيح)

-- UPDATE differences 
-- SET total_value = total_value / 1000 
-- WHERE total_value > 10000;

-- ═══════════════════════════════════════════════════════════════════

-- الخطوة 3: التحقق بعد التصحيح
-- (نفذ هذا بعد تنفيذ UPDATE للتأكد)

-- SELECT 
--     COUNT(*) as "عدد_السجلات",
--     SUM(total_value) as "المجموع_الإجمالي",
--     AVG(total_value) as "المتوسط",
--     MIN(total_value) as "الأصغر",
--     MAX(total_value) as "الأكبر"
-- FROM differences;

-- ═══════════════════════════════════════════════════════════════════

-- البديل: حذف جميع البيانات القديمة والبدء من جديد
-- (احذف التعليق -- إذا أردت حذف كل شيء)

-- DELETE FROM differences;

-- ═══════════════════════════════════════════════════════════════════
-- ✅ انتهى
-- ═══════════════════════════════════════════════════════════════════

